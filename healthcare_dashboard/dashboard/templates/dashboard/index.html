<!DOCTYPE html>
<html>
<head>
    <title>Healthcare Claims Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>US Healthcare Claims Dashboard</h1>

<h2>Summary</h2>
<p><strong>Total Claims:</strong> {{ total_claims }}</p>
<p><strong>Total Cost:</strong> ${{ total_cost }}</p>

<h2>Top Spending Patient</h2>
<p>{{ top_patient }}</p>

<h2>Top 10 Services</h2>
<table border="1">
<tr>
    <th>Service</th>
    <th>Total Cost</th>
</tr>
{% for service in top_services %}
<tr>
    <td>{{ service.Service }}</td>
    <td>{{ service.total_cost }}</td>
</tr>
{% endfor %}
</table>

<h2>Cost by Gender</h2>
<canvas id="genderChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Parse Django context JSON safely
    var genderData = JSON.parse('{{ cost_by_gender|escapejs }}');

    // Map CSV columns to chart labels and values
    var labels = genderData.map(item => item.gender);        // ['F', 'M']
    var costs = genderData.map(item => item.total_cost);     // [103095214.02, 99980042.58]

    // Create bar chart
    new Chart(document.getElementById('genderChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total Cost by Gender',
                data: costs,
                backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)']
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        // Format large numbers nicely
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });
</script>

</body>
</html>